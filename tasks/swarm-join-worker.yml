---
# task file for docker swarm join worker
- name: Register swarm join token worker
  ansible.builtin.shell:
    cmd: docker swarm join-token -q worker
  changed_when: false
  delegate_facts: true
  delegate_to: "{{ groups['docker_swarm_manager'][0] }}"
  register: swarm_join_token_worker

- name: Docker swarm join worker
  ansible.builtin.command:
    cmd: >
      docker swarm join
      --advertise-addr {{ swarm_advertise_addr }}:{{ swarm_port }}
      --listen-addr {{ swarm_listen_addr }}:{{ swarm_port }}
      --token {{ swarm_join_token_worker.stdout }}
      {{ swarm_manager_addr }}:{{ swarm_port }}
